{"data":{"site":{"siteMetadata":{"title":"Web Development","author":"M. Ezzat"}},"markdownRemark":{"id":"8bf7a07f-10e2-5947-b812-57a018150a18","excerpt":"When you create AWS ElasticSearch Service behind VPC, you will not find a direct way to access elasticsearch from outside the local vpc , and the only way to be…","html":"<p>When you create AWS ElasticSearch Service behind VPC, you will not find a direct way to access elasticsearch from outside the local vpc , and the only way to be able to do it is by using ec2 instance inside this vpc and use this instance as a proxy server that will forward the requsers from your local machine to elasticsearch service and responses from elasticsearch to your machine.</p>\n<p>I found this approach very simple and fast when I want to access ElasticSearch for doing some tests or for acceing Kibana console.</p>\n<p>The easiest way from my point of view as a Node.js developer is to use http-proxy , it is very effecient way to create proxy servers.</p>\n<p>So , let’s begin with very basic HTTP server on port 8080.</p>\n<ol>\n<li>create aws ec2 instance inside the vpc</li>\n<li>access it using ssh and install nodejs version >= 8 and git</li>\n<li>forward ports  80 to 8080 and 443 to 8443 </li>\n</ol>\n<p>sudo iptables -t nat -A PREROUTING -p tcp —dport 443 -j REDIRECT —to-port 8443\nsudo iptables -t nat -A PREROUTING -p tcp —dport 80 -j REDIRECT —to-port 8080</p>\n<ol start=\"4\">\n<li>clone this repo\ngit clone <a href=\"https://github.com/enGMzizo/aws-vpc-proxy\">https://github.com/enGMzizo/aws-vpc-proxy</a></li>\n<li>run\nnpm install\nand to start it use this command\nELASTIC_URL=<a href=\"https://XXXXXXXX.eu-west-1.es.amazonaws.com\">https://XXXXXXXX.eu-west-1.es.amazonaws.com</a>  node index.js\nreplace <a href=\"https://XXXXXXXX.eu-west-1.es.amazonaws.com\">https://XXXXXXXX.eu-west-1.es.amazonaws.com</a> with your actual elasticsearch url or ip address.</li>\n</ol>\n<p>and then navigate to your instance ip address on your browser\n<a href=\"http://ipaddress/_plugin/kibana\">http://ipaddress/_plugin/kibana</a>\nYou should be able to see kibana.</p>\n<p>Adding domain and support HTTPS</p>\n<ol>\n<li>generate https credintial for your domain name using <a href=\"https://letsencrypt.org/docs\">https://letsencrypt.org/docs</a>\nand you should have two files private key and certs , You will use these files with your node https server </li>\n<li>add your domain to your server using aws route 53 </li>\n<li>upload your certs files to your server </li>\n<li>uncomment all the code in index.js and add your uploaded private key and server certs </li>\n</ol>\n<p>const credentials = {\nkey: readFileSync(‘PATH<em>TO</em>KEY’, ‘utf8’),\ncert: readFileSync(‘PATH<em>TO</em>CERTS’, ‘utf8’)\n}\nand re-run\nELASTIC_URL=<a href=\"https://XXXXXXXX.eu-west-1.es.amazonaws.com\">https://XXXXXXXX.eu-west-1.es.amazonaws.com</a>  node index.js\nThe node js server should be listning to the port 8443 and it should accept secured connections.</p>\n<ol start=\"5\">\n<li>Now you can access your kibana from your domain name\n<a href=\"https://domain.com/_plugin/kibana\">https://domain.com/_plugin/kibana</a></li>\n</ol>\n<p>This is my first post on my new fake blog! How exciting!</p>\n<div class=\"gatsby-highlight\" data-language=\"javascript\"><pre class=\"language-javascript\"><code class=\"language-javascript\"><span class=\"token keyword\">var</span> m <span class=\"token operator\">=</span> z<span class=\"token punctuation\">;</span></code></pre></div>\n<p>Oh, and here’s a great quote from this Wikipedia on\n<a href=\"http://en.wikipedia.org/wiki/Salted_duck_egg\">salted duck eggs</a>.</p>\n<blockquote>\n<p>B salted duck egg is a Chinese preserved food product made by soaking duck\neggs in brine, or packing each egg in damp, salted charcoal. In Asian\nsupermarkets, these eggs are sometimes sold covered in a thick layer of salted\ncharcoal paste. The eggs may also be sold with the salted paste removed,\nwrapped in plastic, and vacuum packed. From the salt curing process, the\nsalted duck eggs have a briny aroma, a gelatin-like egg white and a\nfirm-textured, round yolk that is bright orange-red in color.</p>\n</blockquote>\n<p>\n  <a\n    class=\"gatsby-resp-image-link\"\n    href=\"/static/8058f3f26913fea3b6a89a73344fe94a/3f5a1/salty_egg.jpg\"\n    style=\"display: block\"\n    target=\"_blank\"\n    rel=\"noopener\"\n  >\n  \n  <span\n    class=\"gatsby-resp-image-wrapper\"\n    style=\"position: relative; display: block;  max-width: 590px; margin-left: auto; margin-right: auto;\"\n  >\n    <span\n      class=\"gatsby-resp-image-background-image\"\n      style=\"padding-bottom: 75%; position: relative; bottom: 0; left: 0; background-image: url('data:image/jpeg;base64,/9j/2wBDABALDA4MChAODQ4SERATGCgaGBYWGDEjJR0oOjM9PDkzODdASFxOQERXRTc4UG1RV19iZ2hnPk1xeXBkeFxlZ2P/2wBDARESEhgVGC8aGi9jQjhCY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2NjY2P/wgARCAAPABQDASIAAhEBAxEB/8QAFgABAQEAAAAAAAAAAAAAAAAAAAMB/8QAFwEAAwEAAAAAAAAAAAAAAAAAAAEEBf/aAAwDAQACEAMQAAABgik0dXC//8QAGRABAAMBAQAAAAAAAAAAAAAAAQACEhEy/9oACAEBAAEFAkqW2DlnRj73yf/EABcRAQADAAAAAAAAAAAAAAAAAAAREkH/2gAIAQMBAT8B1WX/xAAWEQEBAQAAAAAAAAAAAAAAAAAAEQL/2gAIAQIBAT8Bi6f/xAAbEAABBAMAAAAAAAAAAAAAAAAAAQIRISIxMv/aAAgBAQAGPwK9GNocyS8hCj//xAAcEAADAQACAwAAAAAAAAAAAAABESEAMUGBobH/2gAIAQEAAT8hsTTH2wx5gg2ZgM8d5JIfmMRAIe//2gAMAwEAAgADAAAAEMgv/8QAFxEBAQEBAAAAAAAAAAAAAAAAAQARIf/aAAgBAwEBPxARwyusv//EABgRAAIDAAAAAAAAAAAAAAAAAAABESFR/9oACAECAQE/EFoktI//xAAcEAEBAAIDAQEAAAAAAAAAAAABEQAxIWGBQeH/2gAIAQEAAT8QRswtDR5g4a7R5C/RHFM3BKk6zThoVp3lEYcnjGIYES7/ACZ//9k='); background-size: cover; display: block;\"\n    >\n      <img\n        class=\"gatsby-resp-image-image\"\n        style=\"width: 100%; height: 100%; margin: 0; vertical-align: middle; position: absolute; top: 0; left: 0; box-shadow: inset 0px 0px 0px 400px white;\"\n        alt=\"Chinese Salty Egg\"\n        title=\"\"\n        src=\"/static/8058f3f26913fea3b6a89a73344fe94a/f8fb9/salty_egg.jpg\"\n        srcset=\"/static/8058f3f26913fea3b6a89a73344fe94a/e8976/salty_egg.jpg 148w,\n/static/8058f3f26913fea3b6a89a73344fe94a/63df2/salty_egg.jpg 295w,\n/static/8058f3f26913fea3b6a89a73344fe94a/f8fb9/salty_egg.jpg 590w,\n/static/8058f3f26913fea3b6a89a73344fe94a/85e3d/salty_egg.jpg 885w,\n/static/8058f3f26913fea3b6a89a73344fe94a/d1924/salty_egg.jpg 1180w,\n/static/8058f3f26913fea3b6a89a73344fe94a/9452e/salty_egg.jpg 1770w,\n/static/8058f3f26913fea3b6a89a73344fe94a/3f5a1/salty_egg.jpg 2048w\"\n        sizes=\"(max-width: 590px) 100vw, 590px\"\n      />\n    </span>\n  </span>\n  \n  </a>\n    </p>","frontmatter":{"title":"Access AWS ElasticSearch Kibana behind VPC using Node.js","date":"September 01, 2018"}}},"pageContext":{"slug":"/hello-world/","previous":null,"next":null}}